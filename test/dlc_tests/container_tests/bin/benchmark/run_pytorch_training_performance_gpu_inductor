#!/bin/bash
set -e

source /test/bin/pytorch_tests/setupPyTorchBackendTest

pip install -U numpy gitpython matplotlib pandas \
    deepspeed==0.8.2 \
    tabulate==0.9.0

git clone https://github.com/pytorch/pytorch
pushd pytorch

TRAINING_LOG=${AWS_LOG_DIR}/pytorch_inductor_huggingface_benchmark.log
python benchmarks/dynamo/runner.py --suites=huggingface --training --dtypes=amp --compilers=inductor --output-dir=huggingface_logs --extra-args='--output-directory=./' > $TRAINING_LOG 2>&1 
echo "Training Huggingface Complete using PyTorch Inductor."

TRAINING_LOG=${LOG_DIR}/pytorch_inductor_timm_benchmark.log
python benchmarks/dynamo/runner.py --suites=timm_models --training --dtypes=amp --compilers=inductor --output-dir=timm_logs --extra-args='--output-directory=./' > $TRAINING_LOG 2>&1 
echo "Training Timm Complete using PyTorch Inductor."

TRAINING_LOG=${LOG_DIR}/pytorch_inductor_torchbench_benchmark.log
python benchmarks/dynamo/runner.py --suites=torchbench --training --dtypes=amp --compilers=inductor --output-dir=torchbench_logs --extra-args='--output-directory=./' > $TRAINING_LOG 2>&1 
echo "Training Torchbench Complete using PyTorch Inductor."

exit 0